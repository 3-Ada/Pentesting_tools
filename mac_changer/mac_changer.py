import subprocess
import re
from sys import platform
from secrets import token_hex


def get_arguments():
    new_mac_address = gen_rand_mac()
    print(new_mac_address)
    command_options = dict()
    command_options['MAC'] = new_mac_address
    if platform == 'linux' or platform == 'linux2':
        #subprocess.call('ls /sys/class/net', shell=True)
        linux_interface = subprocess.check_output(['ls', '/sys/class/net']).decode('utf-8')
        print(linux_interface)
        linux_interface_list = linux_interface.split()
        print('Choose the interface:')
        for i in range(len(linux_interface_list)):
            print(i, '-', linux_interface_list[i])
        print('Enter number of chosen interface')
        choose_num = int(input())
        interface = linux_interface_list[choose_num]
        print(interface)
        command_options['interface'] = interface
    else:
        command_options['interface'] = 0
    return command_options


def change_mac(new_mac, *interface):
    if platform == 'linux' or platform == 'linux2':
        subprocess.call(f'ifconfig {interface} down', shell=True)
        subprocess.call(f'ifconfig {interface} hw ether {new_mac}', shell=True)
        subprocess.call(f'ifconfig {interface} up', shell=True)
    elif platform == 'win32':
        subprocess.call(
            r'reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class\{'
            r'4D36E972-E325-11CE-BFC1-08002BE10318}\0000 /v NetworkAddress /d ' + new_mac + ' /f')


def get_current_mac(*interface):
    if platform == 'linux' or platform == 'linux2':
        ifconfig_result = subprocess.check_output(['ifconfig', interface])
        mac_address_search_result = re.search(r'\w\w:\w\w:\w\w:\w\w:\w\w:\w\w', ifconfig_result.decode('utf-8'))
    elif platform == 'win32':
        ifconfig_result = subprocess.check_output('getmac')
        mac_address_search_result = re.search(r'\w\w-\w\w-\w\w-\w\w-\w\w-\w\w', ifconfig_result.decode('cp1251'))
    if mac_address_search_result:
        return mac_address_search_result.group(0)
    else:
        return -1


options = get_arguments()

current_mac = get_current_mac(options['interface'])
print('Current MAC:', current_mac)

change_mac(options['MAC'], options['interface'])

current_mac = get_current_mac(options['interface'])
if current_mac == options['MAC']:
    print('MAC address was successfully changed to', current_mac)
else:
    print('MAC address did not get changed')
